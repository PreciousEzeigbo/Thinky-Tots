<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alphabet Quiz - ThinkyTots</title>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            text-align: center;
        }
        .quiz-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-top: 2rem;
            position: relative;
        }
        .timer {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #3b82f6;
        }
        .question {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .option-button {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            background: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-button:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .score {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .start-button, .exit-button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        .start-button {
            background-color: #3b82f6;
            color: white;
        }
        .start-button:hover {
            background-color: #2563eb;
        }
        .exit-button {
            background-color: #ef4444;
            color: white;
            position: absolute;
            top: 1rem;
            right: 1rem;
        }
        .exit-button:hover {
            background-color: #dc2626;
        }
        .correct {
            background-color: #34d399;
            color: white;
            border-color: #34d399;
        }
        .incorrect {
            background-color: #f87171;
            color: white;
            border-color: #f87171;
        }
        .result-screen {
            text-align: center;
            padding: 2rem;
        }
        .result-screen h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        .button-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        .selected {
            background-color: #fde68a;
            border-color: #f59e0b;
            color: #000;
        }

    </style>
</head>
<body class="bg-gray-50">
    <div class="container">
        <h1>Alphabet Quiz</h1>
        <div id="quiz-container" class="quiz-container">
            <div id="start-screen">
                <h2>Test your alphabet knowledge!</h2>
                <p>You have 60 seconds to answer as many questions as possible.</p>
                <div class="button-container">
                    <button class="start-button" onclick="startQuiz()">Start Quiz</button>
                    <a href="{{ url_for('public.home') }}" class="exit-button">Exit</a>
                </div>
            </div>
            <div id="quiz-screen" style="display: none;">
                <button class="exit-button" onclick="exitQuiz()">Exit</button>
                <div class="timer" id="timer">60</div>
                <div class="score">Score: <span id="score">0</span></div>
                <div class="question" id="question"></div>
                <div class="options" id="options"></div>
            </div>
            <div id="result-screen" class="result-screen" style="display: none;">
                <h2>Quiz Complete!</h2>
                <p>Final Score: <span id="final-score">0</span></p>
                <p>Time Taken: <span id="time-taken">0</span> seconds</p>
                <div class="button-container">
                    <button class="start-button" onclick="resetQuiz()">Play Again</button>
                    <a href="/home" class="exit-button">Exit</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AlphabetQuiz {
            constructor() {
                this.score = 0;
                this.timeLeft = 60;
                this.timer = null;
                this.currentQuestion = null;
            }
        
            generateQuestion() {
                const questionTypes = [
                    this.generateNextLetterQuestion,
                    this.generatePreviousLetterQuestion,
                    this.generateMissingLetterQuestion,
                    this.generateVowelConsonantQuestion,
                ];
                const randomType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
                return randomType.call(this);
            }
        
            generateNextLetterQuestion() {
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const randomIndex = Math.floor(Math.random() * 25);
                const letter = alphabet[randomIndex];
                const correctAnswer = alphabet[randomIndex + 1];
                const options = this.generateOptions(correctAnswer);
                return {
                    question: `What letter comes after ${letter}?`,
                    options: options,
                    correctAnswer: correctAnswer,
                };
            }
        
            generatePreviousLetterQuestion() {
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const randomIndex = Math.floor(Math.random() * 25) + 1;
                const letter = alphabet[randomIndex];
                const correctAnswer = alphabet[randomIndex - 1];
                const options = this.generateOptions(correctAnswer);
                return {
                    question: `What letter comes before ${letter}?`,
                    options: options,
                    correctAnswer: correctAnswer,
                };
            }
        
            generateMissingLetterQuestion() {
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const randomIndex = Math.floor(Math.random() * 24) + 1;
                const before = alphabet[randomIndex - 1];
                const after = alphabet[randomIndex + 1];
                const correctAnswer = alphabet[randomIndex];
                const options = this.generateOptions(correctAnswer);
                return {
                    question: `What letter goes between ${before} and ${after}?`,
                    options: options,
                    correctAnswer: correctAnswer,
                };
            }
        
            generateVowelConsonantQuestion() {
                const vowels = 'AEIOU';
                const consonants = 'BCDFGHJKLMNPQRSTVWXYZ';
                const isVowelQuestion = Math.random() < 0.5;
                const numChoices = Math.floor(Math.random() * 3) + 3; // 3-5 letters
                let correctAnswers = [];
                let allOptions = [];
        
                if (isVowelQuestion) {
                    const randomVowel = vowels[Math.floor(Math.random() * vowels.length)];
                    correctAnswers.push(randomVowel);
                    allOptions.push(randomVowel);
                } else {
                    const randomConsonant = consonants[Math.floor(Math.random() * consonants.length)];
                    correctAnswers.push(randomConsonant);
                    allOptions.push(randomConsonant);
                }
        
                while (allOptions.length < numChoices) {
                    const isVowel = Math.random() < 0.3; // 30% chance of vowel
                    const letter = isVowel
                        ? vowels[Math.floor(Math.random() * vowels.length)]
                        : consonants[Math.floor(Math.random() * consonants.length)];
                    if (!allOptions.includes(letter)) {
                        allOptions.push(letter);
                        if (isVowelQuestion && isVowel) {
                            correctAnswers.push(letter);
                        } else if (!isVowelQuestion && !isVowel) {
                            correctAnswers.push(letter);
                        }
                    }
                }
        
                return {
                    question: `Select all the ${isVowelQuestion ? 'vowels' : 'consonants'}:`,
                    options: this.shuffleArray(allOptions),
                    correctAnswers: correctAnswers,
                };
            }
        
            generateOptions(correctAnswer) {
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let options = [correctAnswer];
                while (options.length < 4) {
                    const randomLetter = alphabet[Math.floor(Math.random() * 26)];
                    if (!options.includes(randomLetter)) {
                        options.push(randomLetter);
                    }
                }
                return this.shuffleArray(options);
            }
        
            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
        
            displayQuestion() {
                this.currentQuestion = this.generateQuestion();
                document.getElementById('question').textContent = this.currentQuestion.question;
                const optionsContainer = document.getElementById('options');
                optionsContainer.innerHTML = '';

                const isMultiSelect = Array.isArray(this.currentQuestion.correctAnswers);
                const selectedAnswers = new Set();

                this.currentQuestion.options.forEach((option) => {
                    const button = document.createElement('button');
                    button.className = 'option-button';
                    button.textContent = option;
                    button.onclick = () => {
                        if (isMultiSelect) {
                            if (selectedAnswers.has(option)) {
                                selectedAnswers.delete(option);
                                button.classList.remove('selected');
                            } else {
                                selectedAnswers.add(option);
                                button.classList.add('selected');
                            }
                        } else {
                            this.checkAnswer([option]); // Single-answer question
                        }
                    };
                    optionsContainer.appendChild(button);
                });

                if (isMultiSelect) {
                    const submitButton = document.createElement('button');
                    submitButton.textContent = 'Submit';
                    submitButton.className = 'start-button';
                    submitButton.onclick = () => this.checkAnswer([...selectedAnswers]);
                    optionsContainer.appendChild(submitButton);
                }
            }

            checkAnswer(selectedAnswers) {
                const buttons = document.querySelectorAll('.option-button');
                const correctAnswers = Array.isArray(this.currentQuestion.correctAnswers)
                    ? this.currentQuestion.correctAnswers
                    : [this.currentQuestion.correctAnswer];

                let isCorrect = correctAnswers.every((answer) => selectedAnswers.includes(answer)) &&
                    selectedAnswers.every((answer) => correctAnswers.includes(answer));

                buttons.forEach((button) => {
                    button.disabled = true;
                    if (correctAnswers.includes(button.textContent)) {
                        button.classList.add('correct');
                    } else if (selectedAnswers.includes(button.textContent)) {
                        button.classList.add('incorrect');
                    }
                });

                if (isCorrect) {
                    this.score += 10;
                    document.getElementById('score').textContent = this.score;
                }

                setTimeout(() => this.displayQuestion(), 1000);
            }


        
            startTimer() {
                this.timer = setInterval(() => {
                    if (this.timeLeft > 0) {
                        this.timeLeft--;
                        document.getElementById('timer').textContent = this.timeLeft;
                    } else {
                        this.endQuiz();
                    }
                }, 1000);
            }
        
            async endQuiz() {
                clearInterval(this.timer);
                document.getElementById('quiz-screen').style.display = 'none';
                document.getElementById('result-screen').style.display = 'block';
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('time-taken').textContent = 60 - this.timeLeft;
            }
        }
        
        let quiz;
        function startQuiz() {
            quiz = new AlphabetQuiz();
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            quiz.displayQuestion();
            quiz.startTimer();
        }
        
        function resetQuiz() {
            quiz = new AlphabetQuiz();
            quiz.reset();
        }
        </script>        
</body>
</html>